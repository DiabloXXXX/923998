<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <title>Konfirmasi Pembelian - Maison du Croissant</title>
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />
    <meta content="Maison du Croissant, konfirmasi pembelian, bakery" name="keywords" />
    <meta content="Konfirmasi pembelian di Maison du Croissant - Selesaikan pesanan Anda" name="description" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Libraries Stylesheet -->
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet" />
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet" />
    
    <!-- Enhanced Menu Styles -->
    <link href="css/enhanced-menu.css" rel="stylesheet" />
    
    <!-- Enhanced Responsive Design -->
    <link href="css/responsive-design.css" rel="stylesheet" />
    
    <!-- Cross-Device Compatibility -->
    <link href="css/cross-device-compatibility.css" rel="stylesheet" />
    
    <!-- Luxury Theme -->
    <link href="css/luxury-theme.css" rel="stylesheet" />
</head>

<body>
    <!-- Spinner Start -->
    <div
      id="spinner"
      class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50 d-flex align-items-center justify-content-center"
    >
      <div class="spinner-grow luxury-text-gold" role="status"></div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar start -->
    <div class="container-fluid fixed-top" style="background: var(--luxury-black);">
      <div class="container">
        <nav class="navbar navbar-expand-lg navbar-dark">
          <a href="menu.html" class="navbar-brand">
            <h5 class="mb-0 maison-du-croissant" style="color: var(--luxury-gold); font-family: 'Playfair Display', serif;">
              Maison du Croissant
            </h5>
          </a>
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="menu.html">
                  <i class="fas fa-utensils me-1"></i>Menu
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="cart.html">
                  <i class="fas fa-shopping-cart me-1"></i>Keranjang
                  <span class="badge ms-1 cart-count" style="display: none; background: var(--luxury-gold); color: var(--luxury-black);" id="cartCount">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="confirm-order.html">
                  <i class="fas fa-clipboard-check me-1"></i>Pesanan
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
    <!-- Navbar End -->

    <!-- Single Page Header start -->
    <div class="container-fluid page-header py-5" style="background: var(--luxury-cream); margin-top: 100px;">
      <h1 class="text-center display-4" style="color: var(--luxury-black); font-family: 'Playfair Display', serif; font-weight: 700;">Konfirmasi Pembelian</h1>
    </div>
    <!-- Single Page Header End -->

    <!-- Confirmation Page Start -->
    <div class="container-fluid py-5">
      <div class="container py-5">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="card shadow">
              <div class="card-header luxury-badge">
                <h4 class="mb-0">
                  <i class="fas fa-check-circle me-2"></i>
                  Detail Pesanan Anda
                </h4>
              </div>
              <div class="card-body">
                <!-- Progress Steps -->
                <div class="row mb-4">
                  <div class="col-12">
                    <div class="d-flex justify-content-between">
                      <div class="text-center">
                        <div class="rounded-circle luxury-badge text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px;">
                          <i class="fas fa-shopping-cart"></i>
                        </div>
                        <small>Pilih Produk</small>
                      </div>
                      <div class="text-center">
                        <div class="rounded-circle luxury-badge text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px;">
                          <i class="fas fa-clipboard-check"></i>
                        </div>
                        <small>Konfirmasi</small>
                      </div>
                      <div class="text-center">
                        <div class="rounded-circle text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px; background: var(--luxury-bronze); border: 2px solid var(--luxury-gold);">
                          <i class="fas fa-credit-card"></i>
                        </div>
                        <small>Pembayaran</small>
                      </div>
                      <div class="text-center">
                        <div class="rounded-circle text-white d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px; background: var(--luxury-bronze); border: 2px solid var(--luxury-gold);">
                          <i class="fas fa-check"></i>
                        </div>
                        <small>Selesai</small>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Order Summary -->
                <div id="orderSummary" class="mb-4">
                  <!-- Items akan diload dari localStorage -->
                </div>

                <!-- Customer Information Form -->
                <form id="orderForm">
                  <h5 class="mb-3">
                    <i class="fas fa-user me-2"></i>
                    Informasi Pelanggan
                  </h5>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="customerName" class="form-label">Nama Lengkap *</label>
                      <input type="text" class="form-control" id="customerName" required>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="customerPhone" class="form-label">Nomor Telepon *</label>
                      <input type="tel" class="form-control" id="customerPhone" required>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="customerEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="customerEmail">
                  </div>

                  <h5 class="mb-3 mt-4">
                    <i class="fas fa-clock me-2"></i>
                    Waktu Pengambilan
                  </h5>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="pickupDate" class="form-label">Tanggal Pengambilan *</label>
                      <input type="date" class="form-control" id="pickupDate" required>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="pickupTime" class="form-label">Jam Pengambilan *</label>
                      <select class="form-control" id="pickupTime" required>
                        <option value="">Pilih Jam</option>
                        <option value="08:00">08:00 - 09:00</option>
                        <option value="09:00">09:00 - 10:00</option>
                        <option value="10:00">10:00 - 11:00</option>
                        <option value="11:00">11:00 - 12:00</option>
                        <option value="12:00">12:00 - 13:00</option>
                        <option value="13:00">13:00 - 14:00</option>
                        <option value="14:00">14:00 - 15:00</option>
                        <option value="15:00">15:00 - 16:00</option>
                        <option value="16:00">16:00 - 17:00</option>
                        <option value="17:00">17:00 - 18:00</option>
                      </select>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="specialRequest" class="form-label">Permintaan Khusus</label>
                    <textarea class="form-control" id="specialRequest" rows="3" placeholder="Contoh: Tolong siapkan kotak terpisah untuk setiap jenis pastry"></textarea>
                  </div>

                  <!-- Payment Method -->
                  <h5 class="mb-3 mt-4">
                    <i class="fas fa-credit-card me-2"></i>
                    Metode Pembayaran
                  </h5>
                  
                  <div class="row">
                    <div class="col-md-4 mb-3">
                      <div class="form-check border rounded p-3">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="paymentCash" value="cash" checked>
                        <label class="form-check-label w-100" for="paymentCash">
                          <i class="fas fa-money-bill-wave me-2"></i>
                          Cash (Tunai)
                        </label>
                      </div>
                    </div>
                    <div class="col-md-4 mb-3">
                      <div class="form-check border rounded p-3">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="paymentBank" value="bank">
                        <label class="form-check-label w-100" for="paymentBank">
                          <i class="fas fa-university me-2"></i>
                          Transfer Bank
                        </label>
                      </div>
                    </div>
                    <div class="col-md-4 mb-3">
                      <div class="form-check border rounded p-3">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="paymentEwallet" value="ewallet">
                        <label class="form-check-label w-100" for="paymentEwallet">
                          <i class="fas fa-mobile-alt me-2"></i>
                          E-Wallet
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Order Total -->
                  <div class="card bg-light mt-4">
                    <div class="card-body" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                      <div class="row border-bottom pb-2 mb-2" style="border-color: var(--luxury-gold) !important;">
                        <div class="col-8">
                          <p class="mb-1" style="font-weight: 500;">Subtotal:</p>
                        </div>
                        <div class="col-4 text-end">
                          <p class="mb-1" id="paymentSubtotal" style="font-weight: 500;">Rp 0</p>
                        </div>
                      </div>
                      <div class="row border-bottom pb-2 mb-2" style="border-color: var(--luxury-gold) !important;">
                        <div class="col-8">
                          <p class="mb-1" style="font-weight: 500;">Pajak (PPN 10%):</p>
                        </div>
                        <div class="col-4 text-end">
                          <p class="mb-1" id="paymentTax" style="font-weight: 500;">Rp 0</p>
                        </div>
                      </div>
                      <div class="row mt-2" style="background: rgba(212, 175, 55, 0.1); padding: 1rem; border-radius: 8px;">
                        <div class="col-8">
                          <h5 style="margin-bottom: 0; font-weight: 700;">Total Pembayaran:</h5>
                        </div>
                        <div class="col-4 text-end">
                          <h5 style="color: var(--luxury-gold); font-weight: 700; margin-bottom: 0; font-size: 1.5rem;" id="grandTotal">Rp 0</h5>
                        </div>
                      </div>
                      <hr style="border-color: var(--luxury-gold); opacity: 0.5; margin-top: 1.5rem;">
                      <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Dengan melakukan konfirmasi, Anda menyetujui syarat dan ketentuan yang berlaku.
                      </small>
                    </div>
                  </div>

                  <!-- Action Buttons -->
                  <div class="d-flex justify-content-between mt-4">
                    <a href="cart.html" class="btn btn-luxury-secondary">
                      <i class="fas fa-arrow-left me-2"></i>
                      Kembali ke Keranjang
                    </a>
                    <button type="submit" class="btn btn-luxury-primary btn-lg">
                      <i class="fas fa-paper-plane me-2"></i>
                      Konfirmasi Pesanan
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Confirmation Page End -->

    <!-- Success Modal -->
    <div class="modal fade" id="successOrderModal" tabindex="-1" aria-labelledby="successOrderModalLabel" aria-hidden="true" style="z-index: 1055;">
      <div class="modal-dialog modal-dialog-centered" style="margin: 1.75rem auto; max-width: 500px;">
        <div class="modal-content" style="border-radius: 10px; border: 2px solid var(--luxury-gold);">
          <div class="modal-header luxury-badge" style="border-bottom: 1px solid var(--luxury-gold);">
            <h5 class="modal-title text-white" id="successOrderModalLabel">
              <i class="fas fa-check-circle me-2"></i>Pesanan Berhasil!
            </h5>
          </div>
          <div class="modal-body text-center" style="padding: 2rem;">
            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--luxury-gold);"></i>
            <h4 class="mt-3">Pesanan Berhasil Dikonfirmasi!</h4>
            <p class="text-muted">Pesanan Anda telah berhasil diproses dan diteruskan ke WhatsApp.</p>
            <div class="alert alert-info">
              <h6>Nomor Pesanan: <span id="orderNumber"></span></h6>
              <p class="mb-0">Silakan catat nomor pesanan ini untuk referensi Anda.</p>
            </div>
            <div class="alert alert-success">
              <i class="fab fa-whatsapp me-2"></i>
              <strong>WhatsApp Terbuka Otomatis</strong><br>
              <small>Ringkasan pesanan telah disiapkan dalam format chat WhatsApp untuk konfirmasi langsung dengan tim kami.</small>
            </div>
            <p class="mb-0">
              <strong>Langkah Selanjutnya:</strong><br>
              Kirim pesan WhatsApp yang sudah disiapkan untuk konfirmasi final pesanan Anda.
            </p>
          </div>
          <div class="modal-footer" style="border-top: 1px solid var(--luxury-gold); padding: 1.5rem;">
            <a href="menu.html" class="btn btn-luxury-primary btn-lg w-100">
              <i class="fas fa-home me-2"></i>
              Kembali ke Menu
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Back to Top -->
    <a href="#" class="btn btn-luxury-primary border-3 rounded-circle back-to-top" style="border-color: var(--luxury-gold) !important;"><i class="fa fa-arrow-up"></i></a>

    <!-- Footer Start -->
    <div class="container-fluid py-3" style="background: #1a1a1a; border-top: 1px solid var(--luxury-gold);">
      <div class="container">
        <div class="row g-4">
          <div class="col-lg-6 col-md-8">
            <div class="footer-item">
              <h1 class="mb-2" style="color: var(--luxury-gold); font-family: 'Playfair Display', serif;">Maison du Croissant</h1>
              <p class="mb-0" style="color: var(--luxury-cream); opacity: 0.8; font-size: 1.1rem;">Artisan Bakery</p>
              <p class="mt-3" style="color: var(--luxury-cream); line-height: 1.6;">
                Spesialisasi dalam croissant mewah dengan bahan-bahan terbaik. 
                Kami berkomitmen memberikan pengalaman kuliner yang elegan 
                melalui sentuhan unik pada setiap produk kami.
              </p>
            </div>
          </div>
          <div class="col-lg-6 col-md-4">
            <div class="footer-item">
              <h4 class="mb-3" style="color: #faf8f5 !important; font-weight: 600;">Kontak</h4>
              <p class="mb-2" style="color: var(--luxury-cream);"><i class="fas fa-map-marker-alt me-2" style="color: var(--luxury-gold);"></i>Pondok Cina, Beji, Depok City, West Java</p>
              <p class="mb-2" style="color: var(--luxury-cream);"><i class="fas fa-envelope me-2" style="color: var(--luxury-gold);"></i>info@maisoncroissant.id</p>
              <p class="mb-3" style="color: var(--luxury-cream);"><i class="fas fa-phone me-2" style="color: var(--luxury-gold);"></i>+62 823 8929 6775</p>
              
              <div class="mt-3">
                <a
                  class="btn btn-md-square rounded-circle me-2"
                  style="border: 2px solid var(--luxury-gold); color: var(--luxury-gold); width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center;"
                  href="#"
                  title="Instagram"
                  ><i class="fab fa-instagram"></i></a>
                <a
                  class="btn btn-md-square rounded-circle me-2"
                  style="border: 2px solid var(--luxury-gold); color: var(--luxury-gold); width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center;"
                  href="#"
                  title="WhatsApp"
                  ><i class="fab fa-whatsapp"></i></a>
                <a
                  class="btn btn-md-square rounded-circle"
                  style="border: 2px solid var(--luxury-gold); color: var(--luxury-gold); width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center;"
                  href="#"
                  title="Email"
                  ><i class="fas fa-envelope"></i></a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Copyright Section within Footer -->
        <div class="row border-top mt-3 pt-3" style="border-color: var(--luxury-gold) !important;">
          <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
            <span style="color: var(--luxury-cream);"
              ><a href="#" style="color: var(--luxury-gold); text-decoration: none;"
                ><i class="fas fa-copyright me-2" style="color: var(--luxury-gold);"></i>Maison du
                Croissant</a
              >, All right reserved.</span
            >
          </div>
          <div class="col-md-6 my-auto text-center text-md-end">
            <span style="color: var(--luxury-cream);">Designed By&nbsp;
            <a
              class="px-3 fw-bold"
              style="border: 2px solid var(--luxury-gold); color: var(--luxury-gold); text-decoration: none;"
              href="https://umkmmekarsari.tcugapps.com/profileorangganteng"
              >;P</a></span>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer End -->



    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
    
    <!-- Cross-Device Compatibility Javascript -->
    <script src="js/cross-device-compatibility.js"></script>
    
    <script>
        // WhatsApp Configuration
        // ========================================
        // Nomor WhatsApp: 6289629749277
        // Template sudah disesuaikan dengan format yang diminta
        // Contoh URL yang akan dihasilkan:
        // https://wa.me/6289629749277?text=*KONFIRMASI%20PESANAN%20-%20MAISON%20DU%20CROISSANT*%0A%0A*DETAIL%20PESANAN*%0ANomor%20Pesanan%3A%20ORD1751234545010%0A...
        // ========================================
        const WHATSAPP_CONFIG = {
            phoneNumber: '6289629749277', // Nomor WhatsApp sesuai template
            businessName: 'Maison du Croissant'    // Nama bisnis untuk template pesan
        };

        // Load order data from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            loadOrderSummary();
            setMinDate();
            updateCartCount();
            
            // Form submission
            document.getElementById('orderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                processOrder();
            });
        });

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartBadge = document.getElementById('cartCount');
            
            if (totalItems > 0) {
                cartBadge.textContent = totalItems;
                cartBadge.style.display = 'inline';
            } else {
                cartBadge.style.display = 'none';
            }
        }

        function loadOrderSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const orderSummaryEl = document.getElementById('orderSummary');
            let subtotal = 0;

            if (cart.length === 0) {
                orderSummaryEl.innerHTML = `
                    <div class="alert alert-warning">
                        <h5>Keranjang Kosong</h5>
                        <p>Silakan <a href="menu.html">pilih produk</a> terlebih dahulu.</p>
                    </div>
                `;
                // Reset total pembayaran
                document.getElementById('paymentSubtotal').textContent = 'Rp 0';
                document.getElementById('paymentTax').textContent = 'Rp 0';
                document.getElementById('grandTotal').textContent = 'Rp 0';
                return;
            }

            let summaryHTML = '<h5 class="mb-3"><i class="fas fa-list me-2"></i>Ringkasan Pesanan</h5>';
            
            cart.forEach(item => {
                const itemTotal = item.priceNum * item.quantity;
                subtotal += itemTotal;
                
                summaryHTML += `
                    <div class="row align-items-center border-bottom py-3">
                        <div class="col-2">
                            <img src="${item.image}" class="img-fluid rounded" style="width: 60px; height: 60px; object-fit: cover;">
                        </div>
                        <div class="col-6">
                            <h6 class="mb-1">${item.name}</h6>
                            <small class="text-muted">${item.price} x ${item.quantity}</small>
                        </div>
                        <div class="col-4 text-end">
                            <strong>Rp ${itemTotal.toLocaleString('id-ID')}</strong>
                        </div>
                    </div>
                `;
            });

            // Hitung pajak dan total
            const tax = Math.round(subtotal * 0.1); // PPN 10%
            const total = subtotal + tax;

            summaryHTML += `
                <div class="row mt-3 border-bottom pb-2">
                    <div class="col-8">
                        <p class="mb-1">Subtotal:</p>
                    </div>
                    <div class="col-4 text-end">
                        <p class="mb-1">Rp ${subtotal.toLocaleString('id-ID')}</p>
                    </div>
                </div>
                <div class="row border-bottom pb-2">
                    <div class="col-8">
                        <p class="mb-1">Pajak (PPN 10%):</p>
                    </div>
                    <div class="col-4 text-end">
                        <p class="mb-1">Rp ${tax.toLocaleString('id-ID')}</p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-8">
                        <h5>Total:</h5>
                    </div>
                    <div class="col-4 text-end">
                        <h5 class="luxury-text-gold">Rp ${total.toLocaleString('id-ID')}</h5>
                    </div>
                </div>
            `;

            orderSummaryEl.innerHTML = summaryHTML;
            
            // Update total pembayaran section
            document.getElementById('paymentSubtotal').textContent = 'Rp ' + subtotal.toLocaleString('id-ID');
            document.getElementById('paymentTax').textContent = 'Rp ' + tax.toLocaleString('id-ID');
            document.getElementById('grandTotal').textContent = 'Rp ' + total.toLocaleString('id-ID');
        }

        function setMinDate() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const dateString = tomorrow.toISOString().split('T')[0];
            document.getElementById('pickupDate').min = dateString;
            document.getElementById('pickupDate').value = dateString;
        }

        function processOrder() {
            // Generate order number
            const orderNumber = 'ORD' + Date.now();
            
            // Get form data
            const orderData = {
                orderNumber: orderNumber,
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerEmail: document.getElementById('customerEmail').value,
                pickupDate: document.getElementById('pickupDate').value,
                pickupTime: document.getElementById('pickupTime').value,
                specialRequest: document.getElementById('specialRequest').value,
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value,
                items: JSON.parse(localStorage.getItem('cart')) || [],
                timestamp: new Date().toISOString()
            };

            // Store order data
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push(orderData);
            localStorage.setItem('orders', JSON.stringify(orders));

            // Generate WhatsApp message
            const whatsappMessage = generateWhatsAppMessage(orderData);
            
            // Open WhatsApp
            const whatsappUrl = `https://wa.me/${WHATSAPP_CONFIG.phoneNumber}?text=${encodeURIComponent(whatsappMessage)}`;
            
            // Clear cart
            localStorage.removeItem('cart');

            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');

            // Show success modal
            document.getElementById('orderNumber').textContent = orderNumber;
            const successModal = new bootstrap.Modal(document.getElementById('successOrderModal'));
            successModal.show();
        }

        function generateWhatsAppMessage(orderData) {
            const cart = orderData.items;
            let subtotal = 0;
            
            // Calculate subtotal
            cart.forEach(item => {
                subtotal += item.priceNum * item.quantity;
            });
            
            const tax = Math.round(subtotal * 0.1); // PPN 10%
            const total = subtotal + tax;
            
            // Format pickup date
            const pickupDate = new Date(orderData.pickupDate);
            const formattedDate = pickupDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Build message according to template format
            let message = `*KONFIRMASI PESANAN - MAISON DU CROISSANT*\n\n`;
            
            message += `*DETAIL PESANAN*\n`;
            message += `Nomor Pesanan: ${orderData.orderNumber}\n`;
            message += `Nama: ${orderData.customerName}\n`;
            message += `No. Telepon: ${orderData.customerPhone}\n`;
            message += `Email: ${orderData.customerEmail}\n\n`;
            
            message += `*JADWAL PENGAMBILAN*\n`;
            message += `Tanggal: ${formattedDate}\n`;
            message += `Waktu: ${orderData.pickupTime}\n\n`;
            
            message += `*RINGKASAN PESANAN*\n`;
            cart.forEach((item, index) => {
                const itemTotal = item.priceNum * item.quantity;
                message += `${index + 1}. ${item.name} = ${item.price} x ${item.quantity} = Rp${itemTotal.toLocaleString('id-ID')}\n`;
            });
            message += `\n`;
            
            message += `*DETAIL PEMBAYARAN*\n`;
            message += `Subtotal: Rp${subtotal.toLocaleString('id-ID')}\n`;
            message += `PPN 10%: Rp${tax.toLocaleString('id-ID')}\n`;
            message += `*Total: Rp${total.toLocaleString('id-ID')}*\n`;
            message += `Metode Pembayaran: ${orderData.paymentMethod}\n\n`;
            
            if (orderData.specialRequest && orderData.specialRequest.trim() !== '') {
                message += `*PERMINTAAN KHUSUS*\n`;
                message += `${orderData.specialRequest}\n\n`;
            }
            
            message += `Mohon konfirmasi pesanan ini untuk melanjutkan proses.\n\n`;
            message += `Terima kasih telah memilih Maison du Croissant 🍞`;
            
            return message;
        }

        // Debug function untuk testing WhatsApp URL
        function debugWhatsApp() {
            // Test data
            const testOrderData = {
                orderNumber: 'ORD1751234545010',
                customerName: 'Agus Gunawan',
                customerPhone: '089629749277',
                customerEmail: 'yugiindra40@gmail.com',
                pickupDate: '2025-06-30',
                pickupTime: '08:00',
                paymentMethod: 'E-wallet',
                specialRequest: '',
                items: [
                    {
                        name: 'Eclair',
                        price: 'Rp 35.000',
                        priceNum: 35000,
                        quantity: 1
                    }
                ]
            };
            
            const message = generateWhatsAppMessage(testOrderData);
            const whatsappUrl = `https://wa.me/${WHATSAPP_CONFIG.phoneNumber}?text=${encodeURIComponent(message)}`;
            
            console.log('Generated WhatsApp URL:');
            console.log(whatsappUrl);
            console.log('\nDecoded Message:');
            console.log(message);
        }

        // Uncomment line di bawah untuk testing
        // debugWhatsApp();
    </script>
</body>
</html>
